<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vocabulary</title>
    <link rel="stylesheet" href="src/ui/styles.css" />
    <!-- Add this script to detect page type before loading any other scripts -->
    <script>
      window.isVocabManagerPage = true;
    </script>
  </head>
  <body>
    <div class="app-container">
      <div class="header">
        <h1>Vocabulary</h1>
        <div class="subtitle">Edit and update your vocabulary list</div>
        <a href="index.html" class="back-to-main-link">‚Üê Back to Main Page</a>
      </div>

      <div class="vocab-manager-container">
        <!-- Expand Vocabulary Section -->
        <section class="expand-vocabulary-section">
          <h2>Expand Vocabulary</h2>

          <div id="textParserForm">
            <h3>Text Parser</h3>
            <p>
              Paste a Spanish text below to find new words for your vocabulary:
            </p>
            <textarea
              id="textToAnalyze"
              placeholder="e.g., Pisar de forma intermitente el freno para advertir con las luces de frenado que va a reducir la marcha."
            ></textarea>
            <button id="analyzeTextBtn" class="primary-btn">
              Analyze Text
            </button>
          </div>

          <!-- Message Container moved here for better visibility -->
          <div id="messageContainer"></div>

          <!-- Vocabulary Updates Subsection -->
          <div class="vocabulary-updates-subsection">
            <h3>üìù Vocabulary Updates</h3>
            <p>
              New words to be added to your vocabulary. Review translations and
              details before saving:
            </p>
            <div
              class="vocab-table-container"
              style="max-height: none; overflow: visible"
            >
              <table class="vocab-table">
                <thead>
                  <tr>
                    <th>Spanish Word</th>
                    <th>Translation</th>
                    <th>Category</th>
                    <th>Example</th>
                  </tr>
                </thead>
                <tbody id="vocabularyUpdatesTableBody"></tbody>
              </table>
            </div>
            <div class="modal-actions">
              <button id="createMergeRequest" class="primary-btn">
                üöÄ Create Pull Request
              </button>
              <button id="clearVocabularyUpdates" class="secondary-btn">
                Clear Updates
              </button>
            </div>
          </div>
        </section>

        <!-- Current Vocabulary Section -->
        <section class="current-vocabulary-section">
          <h2>Current Vocabulary</h2>

          <!-- Add Filter Controls -->
          <div class="filter-controls">
            <div class="filter-group">
              <label for="wordFilter">Filter Word:</label>
              <input
                type="text"
                id="wordFilter"
                placeholder="Filter by Spanish word"
              />
            </div>
            <div class="filter-group">
              <label for="translationFilter">Filter Translation:</label>
              <input
                type="text"
                id="translationFilter"
                placeholder="Filter by translation"
              />
            </div>
            <div class="filter-group">
              <label for="categoryVocabFilter">Filter Category:</label>
              <select id="categoryVocabFilter">
                <option value="">All Categories</option>
                <!-- Categories will be populated dynamically -->
              </select>
            </div>
            <div class="filter-actions">
              <button id="clearFilters" class="secondary-btn">
                Clear Filters
              </button>
            </div>
          </div>

          <div class="vocab-table-container">
            <table class="vocab-table">
              <thead>
                <tr>
                  <th>Spanish Word</th>
                  <th>Translation</th>
                  <th>Category</th>
                  <th style="width: 40%">Example</th>
                </tr>
              </thead>
              <tbody id="vocabTableBody"></tbody>
            </table>
          </div>
        </section>
      </div>

      <script src="src/core/vocabulary.js"></script>
      <script src="src/ui/icons.js"></script>
      <script src="src/utils/script.js"></script>
      <script src="src/features/vocabulary-manager/github-integration.js"></script>
      <script src="src/features/vocabulary-manager/vocabulary-manager.js"></script>
      <script>
        // Custom initialization for vocabulary manager page
        document.addEventListener("DOMContentLoaded", function () {
          // Create a simplified version of DGTVocabulary for the manager page
          class VocabManagerApp {
            constructor() {
              this.allCards = [];
              this.knownCardsSet = new Set();
              this.vocabularyUpdates = [];
              this.loadFlashcards();
              this.loadProgress();
              this.loadVocabularyUpdates();
            }

            loadFlashcards() {
              try {
                if (typeof window.vocabularyData !== "undefined") {
                  this.allCards = window.vocabularyData.map((card, index) => ({
                    id: index,
                    word: card.word || "",
                    translation: card.translation || "",
                    category: card.category || "",
                    example: card.example || "",
                  }));
                } else {
                  console.error(
                    "Vocabulary data not found. Make sure vocabulary.js is loaded."
                  );
                  return;
                }
              } catch (error) {
                console.error("Error loading flashcards:", error);
              }
            }

            loadProgress() {
              const saved = localStorage.getItem("dgt-vocab-progress");
              if (saved) {
                this.knownCardsSet = new Set(JSON.parse(saved));
              }
            }

            loadVocabularyUpdates() {
              const saved = localStorage.getItem(
                "dgt-vocab-vocabulary-updates"
              );
              if (saved) {
                this.vocabularyUpdates = JSON.parse(saved);
              }
            }

            showMessage(text, type) {
              const messageContainer =
                document.getElementById("messageContainer");
              if (messageContainer) {
                messageContainer.innerHTML = `<div class="${type}-message">${text}</div>`;
                messageContainer.scrollIntoView({
                  behavior: "smooth",
                  block: "nearest",
                });
              } else {
                alert(text);
              }
            }

            getUniqueCategories() {
              const categories = new Set();
              this.allCards.forEach((card) => {
                if (card.category) {
                  categories.add(card.category.toLowerCase());
                }
              });

              ["noun", "verb", "adjective", "adverb", "other"].forEach(
                (cat) => {
                  categories.add(cat);
                }
              );

              return Array.from(categories).sort();
            }
          }

          // Use our custom app instead of DGTVocabulary
          const vocabApp = new VocabManagerApp();
          // Now that the VocabularyManager class is loaded, we can create an instance
          new VocabularyManager(vocabApp);
        });
      </script>
    </div>
  </body>
</html>
